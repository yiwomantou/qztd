# -*- coding: utf-8 -*-
import requests
import scrapy
import json
import time
from amz_spider.tool.db.mysql_server import Mysql_server
import time, datetime


class SellerspriteParseSpider(scrapy.Spider):
    name = 'oalur_parse'
    allowed_domains = ['www.sellersprite', "www.baidu.com"]
    start_urls = ["https://www.oalur.com"]
    custom_settings = {
        # "LOG_LEVEL": "ERROR",
        'RETRY_TIMES': 20,
        'DOWNLOAD_DELAY': 2,
        'CONCURRENT_REQUESTS': 1,
        'HTTPERROR_ALLOWED_CODES': [404, 503, 302, 301, 400],
        'REDIRECT_ENABLED': False,
        'ITEM_PIPELINES': {
            # 'amz_spider.pipelines.SellerspritePipeline': 300
        },
        # 'DOWNLOADER_MIDDLEWARES': {'amz_spider.middlewares.ProxyMiddleware': 400, },
    }

    def __init__(self):
        self.headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.61 Safari/537.36',
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
            "accept-encoding": "gzip, deflate, br",
            "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7",
            "cache-control": "max-age=0"
        }
        cookie_list = {
            '16532819720': [{"domain":".oalur.com","hostOnly":False,"httpOnly":False,"name":"Hm_lpvt_58756a1be1ff5d340845e8a9538c6e17","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"1596440229","id":1},{"domain":".oalur.com","expirationDate":1627976229,"hostOnly":False,"httpOnly":False,"name":"Hm_lvt_58756a1be1ff5d340845e8a9538c6e17","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1596093659,1596437756","id":2},{"domain":"www.oalur.com","expirationDate":1630048856,"hostOnly":True,"httpOnly":False,"name":"_pk_id.1.08fc","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"03024310cf3ebc04.1596093656.3.1596440228.1596440074.","id":3},{"domain":"www.oalur.com","expirationDate":1596442028,"hostOnly":True,"httpOnly":False,"name":"_pk_ses.1.08fc","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":4},{"domain":"www.oalur.com","hostOnly":True,"httpOnly":False,"name":"_pk_testcookie.1.08fc","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"1","id":5},{"domain":"www.oalur.com","expirationDate":1596524109,"hostOnly":True,"httpOnly":False,"name":"clientId","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"04fe1760c3394fff88605528b923f3b9","id":6},{"domain":"www.oalur.com","expirationDate":1596526628,"hostOnly":True,"httpOnly":False,"name":"createdAt","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2020-02-16T01%3A47%3A17.179Z","id":7},{"domain":"www.oalur.com","expirationDate":1596526473.559322,"hostOnly":True,"httpOnly":True,"name":"EGG_SESS","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"suO6WhBgw2UhLzqx4FvJHyYJeQfEYIydnRT81mUpqWsZFEviaPL4zT0S_daXRuY0","id":8},{"domain":"www.oalur.com","expirationDate":1596526628,"hostOnly":True,"httpOnly":False,"name":"name","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"%E7%A5%9E%E7%BB%8F%E8%9B%99","id":9},{"domain":"www.oalur.com","expirationDate":1596526628,"hostOnly":True,"httpOnly":False,"name":"url","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"%2Fdetail%2Fproducts%2Finformation%3Fasin%3DB00NLLUMOE%26site%3DUS","id":10},{"domain":"www.oalur.com","expirationDate":1596526628,"hostOnly":True,"httpOnly":False,"name":"userId","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"5e489f25a473ff360d8a9454","id":11}]
            # '16532819723': [{"domain":".sellersprite.com","expirationDate":1658630850,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.2125874586.1595558116","id":1},{"domain":".sellersprite.com","expirationDate":1595645250,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.1784898556.1595558116","id":2},{"domain":".sellersprite.com","expirationDate":1611326780,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_52352b20-f27b-4d24-aabb-c0e4d4af2b7b","id":3},{"domain":".sellersprite.com","expirationDate":1611110849.717576,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"y8jMWRhZNlzP0Sl2_CN","id":4},{"domain":"www.sellersprite.com","expirationDate":3743042493.940104,"hostOnly":False,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"4467855951IrZXNTSoIlHhPKyHGfg/7SkZmVk3bqKCph7rxPUYnZGveHLHT6NlA0XR08iB8gx8Fl1I+EW4IBjFgzCCb1jQwdZoQzm3LZzTuthOBG66ipI=\"","id":5},{"domain":"www.sellersprite.com","expirationDate":1595559380,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":6},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"9E383EAB105B24DB5F6E782448F51E78","id":7},{"domain":"www.sellersprite.com","expirationDate":1611110094.620925,"hostOnly":False,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2","id":8},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"4467855951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO2qFfXVXyAhl7S9K3vxWie2","id":9}]
            # "16532655630": [{"domain":".sellersprite.com","expirationDate":1658541015,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.537533387.1595402405","id":1},{"domain":".sellersprite.com","expirationDate":1595469036,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555415,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.908086902.1595402405","id":3},{"domain":".sellersprite.com","expirationDate":1611237001,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_bc4bfc36-2c16-4d54-9376-155417b0345b","id":4},{"domain":".sellersprite.com","expirationDate":1611020999.004483,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"wMSwsZgZYoZiAeb8_CN","id":5},{"domain":"www.sellersprite.com","expirationDate":3742952644.827836,"hostOnly":True,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"5977945951IrZXNTSoIlHhPKyHGfg/7TsRzp5mouqclKyd4L/g95mY6JhuZSdw5xuTdObA+Z2ZdEU+IWBBopINPysc6Bg1hCnhmnOW0CJSoE6ystZC7M0=\"","id":6},{"domain":"www.sellersprite.com","expirationDate":1595469601,"hostOnly":True,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":7},{"domain":"www.sellersprite.com","expirationDate":1610955684.643163,"hostOnly":True,"httpOnly":False,"name":"current_guest","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"UUY6GSRoEgFB_200722-150429","id":8},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":True,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"B4268AEA9FDB8D9F5B337748DEC97D74","id":9},{"domain":"www.sellersprite.com","expirationDate":1626939708,"hostOnly":True,"httpOnly":False,"name":"module-station-keyword-reverse","path":"/v2/keyword-reverse","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"FR","id":10},{"domain":"www.sellersprite.com","expirationDate":1610954394.013493,"hostOnly":True,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":11},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"5977945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO1wC7fVO8YTHY3IpOvwD+zt","id":12}],
            # "16532655629": [{"domain":".sellersprite.com","expirationDate":1658541145,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.592130816.1595469139","id":1},{"domain":".sellersprite.com","expirationDate":1595469198,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555545,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.978705191.1595469139","id":3},{"domain":".sellersprite.com","expirationDate":1611237129,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_ce033ce9-fbc1-4d11-a788-c385e9a56354","id":4},{"domain":".sellersprite.com","expirationDate":1627005144.372083,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"C2JxL1YfUhx8C1dJ_CN","id":5},{"domain":"www.sellersprite.com","expirationDate":3742952779.849754,"hostOnly":True,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"0397945951IrZXNTSoIlHhPKyHGfg/7ezIvLAYTuzmrBnyXMtu1/COTb/K4PmKpQixf0lclW65h3JbAD/1CFz3JM5KgyO82ymfcXzbFdunQnsbroso0KM=\"","id":6},{"domain":"www.sellersprite.com","expirationDate":1595469729,"hostOnly":True,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":7},{"domain":"www.sellersprite.com","expirationDate":1611021132.849772,"hostOnly":True,"httpOnly":False,"name":"current_guest","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"5k3aJKv4HQKd_200723-097601","id":8},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":True,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"F152454CD98BB663542E47F050D7B23F","id":9},{"domain":"www.sellersprite.com","expirationDate":1611021124.77942,"hostOnly":True,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":10},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-guest-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"1397945951IrZXNTSoIlHhPKyHGfg/7f5qKmPRnt6HO48ic0PwAPhQSGjOB1s6CLxrhfaam4kV","id":11},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"0397945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO1yzc/YLDyoZVZGzrDfDQQi","id":12}],
            # "16742707920": [{"domain":".sellersprite.com","expirationDate":1658541298,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.1705318844.1595469229","id":1},{"domain":".sellersprite.com","expirationDate":1595469358,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555698,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.1947244699.1595469229","id":3},{"domain":".sellersprite.com","expirationDate":1611237299,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_6b8afd01-f33c-409c-90f1-7876eb47a2fb","id":4},{"domain":".sellersprite.com","expirationDate":1627005229.889523,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"alvFSsVSqCiE1gvv_CN","id":5},{"domain":"www.sellersprite.com","expirationDate":3742952867.519568,"hostOnly":True,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"8108945951IrZXNTSoIlHhPKyHGfg/7ezIvLAYTuzmrBnyXMtu1/CwRroa5eS+GvdWdkGbsYT3McWvpxWNmEyPXKG8AyquMMX9jRQWz067Qsfiws9DRcM=\"","id":6},{"domain":"www.sellersprite.com","expirationDate":1595469900,"hostOnly":True,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":7},{"domain":"www.sellersprite.com","expirationDate":1611021220.519585,"hostOnly":True,"httpOnly":False,"name":"current_guest","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GVo8polgApFT_200723-099722","id":8},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":True,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"729DDC47FF68D7DB399DD42AB4C7145B","id":9},{"domain":"www.sellersprite.com","expirationDate":1611021209.435201,"hostOnly":True,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"0","id":10},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-guest-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"9108945951IrZXNTSoIlHhPKyHGfg/7f5qKmPRnt6HO48ic0PwAPiDi2bc64V6D+Ee5kjTKTmt","id":11},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"8108945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO12B1dXd05OuXFO4O7zO/Sx","id":12}],
            # '17199941154': [{"domain":".sellersprite.com","expirationDate":1658541399,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.297533397.1595469369","id":1},{"domain":".sellersprite.com","expirationDate":1595469429,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555799,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.786652268.1595469369","id":3},{"domain":".sellersprite.com","expirationDate":1611237371,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_bae53e7d-0ee9-42ec-ac05-8772f67356e8","id":4},{"domain":".sellersprite.com","expirationDate":1611021380.604197,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"k4B0uSmYNzqEgYj9_CN","id":5},{"domain":"www.sellersprite.com","expirationDate":3742953026.001506,"hostOnly":False,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"6718945951IrZXNTSoIlHhPKyHGfg/7TaMAJAIZFwSEIlRfIyYPduprkV50bTTezHomYHU0oI7T7u4gtFdSAvRR2GUj/bFOSVR10GnaggT2AUhWHYEMPA=\"","id":6},{"domain":"www.sellersprite.com","expirationDate":1595469971,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":7},{"domain":"www.sellersprite.com","expirationDate":1611021368.916326,"hostOnly":False,"httpOnly":False,"name":"current_guest","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"VxKGcUsrChNp_200723-094632","id":8},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1761FC3A0589D4E16FD388A168F63EAF","id":9},{"domain":"www.sellersprite.com","expirationDate":1611021368.916363,"hostOnly":False,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"0","id":10},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"rank-guest-user","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"6718945951IrZXNTSoIlHhPKyHGfg/7f5qKmPRnt6HO48ic0PwAPh76FiJUVig+4Yc+vVDQRxG","id":11},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"6718945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO2YR3L0N93WHkR54MlSg8kM","id":12}],
            # '17199941157': [{"domain":".sellersprite.com","expirationDate":1658541498,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.190205432.1595469499","id":1},{"domain":".sellersprite.com","expirationDate":1595469558,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555898,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.1757995790.1595469499","id":3},{"domain":".sellersprite.com","expirationDate":1611237489,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_2e02541f-f3d1-4b80-a10a-eedfae284f8f","id":4},{"domain":"www.sellersprite.com","expirationDate":3742953140.371993,"hostOnly":False,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"1928945951IrZXNTSoIlHhPKyHGfg/7XnS9+JFCiDfPzwDDuL/gLnnGHe+DsUGNuXN71wCDwvVm9EdamemGgDXMB4vT2WVH26z8gPo4ayiP+rRstOsgmk=\"","id":5},{"domain":"www.sellersprite.com","expirationDate":1595470089,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":6},{"domain":"www.sellersprite.com","expirationDate":1611021493.372011,"hostOnly":False,"httpOnly":False,"name":"current_guest","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"XiR1MeN59fld_200723-093171","id":7},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"4FB23F6A1E9E36B2E631378CB2865DA0","id":8},{"domain":"www.sellersprite.com","expirationDate":1611021485.322678,"hostOnly":False,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2","id":9},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"rank-guest-user","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2928945951IrZXNTSoIlHhPKyHGfg/7f5qKmPRnt6HO48ic0PwAPgxv7qZhHFJ6zGaIpdOpXtK","id":10},{"domain":"www.sellersprite.com","hostOnly":False,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1928945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO2X7O9CUI1X0Wj388U+atou","id":11}],
            # "16732680944": [{"domain":".sellersprite.com","expirationDate":1658541584,"hostOnly":'',"httpOnly":'',"name":"_ga","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"GA1.2.2100733304.1595469584","id":1},{"domain":".sellersprite.com","expirationDate":1595469644,"hostOnly":'',"httpOnly":'',"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595555984,"hostOnly":'',"httpOnly":'',"name":"_gid","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"GA1.2.1756513817.1595469584","id":3},{"domain":".sellersprite.com","expirationDate":1611237585,"hostOnly":'',"httpOnly":'',"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":'',"session":'',"storeId":"0","value":"session_3186b6da-909e-465c-bf45-05ca0afed28f","id":4},{"domain":"www.sellersprite.com","expirationDate":3742953224.535634,"hostOnly":'',"httpOnly":'',"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"\"5738945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO3jCeKauoqRu9yDz5xZYZsit6NdC/9+FUqSH498PbEwQZTO3nSVjmg/HpGsjnaIEHI=\"","id":5},{"domain":"www.sellersprite.com","expirationDate":1611021577.535652,"hostOnly":'',"httpOnly":'',"name":"current_guest","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"zLkh2xhU4Vel_200723-093429","id":6},{"domain":"www.sellersprite.com","hostOnly":'',"httpOnly":'',"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"C7F223262313DD789E6B17092FA81445","id":7},{"domain":"www.sellersprite.com","expirationDate":1611021571.467966,"hostOnly":'',"httpOnly":'',"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"2","id":8},{"domain":"www.sellersprite.com","hostOnly":'',"httpOnly":'',"name":"rank-guest-user","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"6738945951IrZXNTSoIlHhPKyHGfg/7f5qKmPRnt6HO48ic0PwAPhazh2gJcMAvHCebct293wG","id":9},{"domain":"www.sellersprite.com","hostOnly":'',"httpOnly":'',"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"5738945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO27VNNuDPthsMb/MgoFgyz6","id":10}],
            # "16744948183": [{"domain":".sellersprite.com","expirationDate":1658630005,"hostOnly":False,"httpOnly":False,"name":"_ga","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.263823973.1595469717","id":1},{"domain":".sellersprite.com","expirationDate":1595558053,"hostOnly":False,"httpOnly":False,"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595644405,"hostOnly":False,"httpOnly":False,"name":"_gid","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"GA1.2.71913999.1595557927","id":3},{"domain":".sellersprite.com","expirationDate":1611325887,"hostOnly":False,"httpOnly":False,"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"session_d21293fb-4146-4d6e-9cdd-1c4fd41f26af","id":4},{"domain":".sellersprite.com","expirationDate":1611109888.253444,"hostOnly":False,"httpOnly":False,"name":"ecookie","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"P8hw5jU5O0iMkfBu_CN","id":5},{"domain":"www.sellersprite.com","expirationDate":3743041534.232627,"hostOnly":True,"httpOnly":False,"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"\"6866855951IrZXNTSoIlHhPKyHGfg/7XJh9d4IiZ3QxOmOoRAhsDOyLSqzqOqcTh6H1BhYh/cluOswSBnzX6nUs2bHJI8ZH7kqxlVGzkslqOFl8pF1CqE=\"","id":6},{"domain":"www.sellersprite.com","expirationDate":1595558488,"hostOnly":True,"httpOnly":False,"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":False,"session":False,"storeId":"0","value":"0","id":7},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":True,"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"A134325DB970CBB6863B656D76BFDCA8","id":8},{"domain":"www.sellersprite.com","expirationDate":1611021704.523188,"hostOnly":True,"httpOnly":False,"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":False,"session":False,"storeId":"0","value":"2","id":9},{"domain":"www.sellersprite.com","hostOnly":True,"httpOnly":False,"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":False,"session":True,"storeId":"0","value":"6866855951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO1aPi9tM3G//WTnAT9FEGC/","id":10}],
            # '17180468576': [{"domain":".sellersprite.com","expirationDate":1658541717,"hostOnly":'',"httpOnly":'',"name":"_ga","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"GA1.2.263823973.1595469717","id":1},{"domain":".sellersprite.com","expirationDate":1595469777,"hostOnly":'',"httpOnly":'',"name":"_gat_gtag_UA_135032196_1","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"1","id":2},{"domain":".sellersprite.com","expirationDate":1595556117,"hostOnly":'',"httpOnly":'',"name":"_gid","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"GA1.2.1333596860.1595469717","id":3},{"domain":".sellersprite.com","expirationDate":1611237708,"hostOnly":'',"httpOnly":'',"name":"crisp-client%2Fsession%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":'',"session":'',"storeId":"0","value":"session_82c05979-a81f-4ab6-a3ea-da6c54fecc6b","id":4},{"domain":"www.sellersprite.com","expirationDate":3742953357.962244,"hostOnly":'',"httpOnly":'',"name":"ao_lo_to_n","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"\"8058945951IrZXNTSoIlHhPKyHGfg/7TsRzp5mouqclKyd4L/g95lKhbdIu53TBEv3t1uQD1/TLhG0PoEIO0ArjcSUBSl45YMw0H8LDxw0bGwf61Niyw0=\"","id":5},{"domain":"www.sellersprite.com","expirationDate":1595470308,"hostOnly":'',"httpOnly":'',"name":"crisp-client%2Fsocket%2F02ce6ae3-e1ab-4bb7-ae11-b1a839c52e78","path":"/","sameSite":"lax","secure":'',"session":'',"storeId":"0","value":"0","id":6},{"domain":"www.sellersprite.com","hostOnly":'',"httpOnly":'',"name":"JSESSIONID","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"4551A72FA7626E95C04C657BA0997D89","id":7},{"domain":"www.sellersprite.com","expirationDate":1611021704.523188,"hostOnly":'',"httpOnly":'',"name":"rank_c_s_ind","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"2","id":8},{"domain":"www.sellersprite.com","hostOnly":'',"httpOnly":'',"name":"rank-login-user","path":"/","sameSite":"unspecified","secure":'',"session":'',"storeId":"0","value":"8058945951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO1ldKfcoKdl1xwGQJiE2NSF","id":9}],
        }
        # cookie_str = cookie_list['16742707920'] #'rank_c_s_ind=2; ecookie=hO9WONzzWXqyClNQ_CN; rank-login-user=2645425951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO3QHsqCpranarSMCE0m1Oms; ao_lo_to_n="2645425951IrZXNTSoIlHhPKyHGfg/7dTNF0YCScJ30HDI+PbH9Uz0UHHGHzgewWAgU36Uhfab0MrW5xCklzIqRtyq5nUVVIdjh942/bIia6eAB2sz6Lg="; JSESSIONID=133D9DC7DBEBA2AF7412DD7270CE5F84'
        # cookie_str = cookie_list['16742707920'] #'rank_c_s_ind=2; ecookie=hO9WONzzWXqyClNQ_CN; rank-login-user=2645425951IrZXNTSoIlHhPKyHGfg/7TMbw6xY7YpCjminsqgfQO3QHsqCpranarSMCE0m1Oms; ao_lo_to_n="2645425951IrZXNTSoIlHhPKyHGfg/7dTNF0YCScJ30HDI+PbH9Uz0UHHGHzgewWAgU36Uhfab0MrW5xCklzIqRtyq5nUVVIdjh942/bIia6eAB2sz6Lg="; JSESSIONID=133D9DC7DBEBA2AF7412DD7270CE5F84'
        self.cookies = {i['name']: i['value'] for i in cookie_list[
            '16532819720']}  # {i.split('=')[0]: i.split('=')[-1] for i in cookie_str.split("; ")}
        self.countryCode = {"us": "1", "jp": "2", "uk": "3", "de": "4", "fr": "5", "it": "6", "es": "7", "ca": "8"
                            }
        self.country_list = ["us"]# "de", "fr", "it","es", "jp", "uk"]

    def start_requests(self):
        for country in self.country_list:
            # mysql_server = Mysql_server()
            # cursor = mysql_server.get_cursor()
            table_name = country + '_asins'
            # cursor.execute(f"-- select asin from us_asins limit 1")   #{table_name} where state=4 limit 50")
            task_list = [('B07FJGGWJL',)]
            # task_list = cursor.fetchall()
            print(task_list)
            for task in task_list:
                task = {'asin': task[0], 'country': country}
                parmas = (task['asin'],)
                # update_sql = f"""update {table_name} set state=4 where asin=%s"""
                # cursor.execute(update_sql, parmas)
            # mysql_server.conn.commit()
            # mysql_server.close()
            for task in task_list:
                task = {'asin': task[0], 'country': country}
                if len(task['asin']) > 10 and '?' in task['asin']:
                    asin = task['asin'].split('/')[-1].split('?')[0]
                    if len(asin) == 10:
                        asin = asin.upper()
                elif len(task['asin']) == 10:
                    asin = task['asin'].upper()
                item = {}
                item['asin'] = task['asin']
                item['country'] = country
                item['table_name'] = table_name
                item['total_dict'] = {}
                item['rankHistory'] = {}
                url = f"https://www.oalur.com/api/products/details?site=US&t=1596093777765&asin=" + task['asin']
                yield scrapy.Request(url, method='get',  # body=json.dumps(post),
                                     meta={'country': country, 'asin': task['asin'],
                                           'retry_number': 0, 'table_name': table_name,
                                           "item": item},
                                     headers=self.headers, callback=self.parse, dont_filter=True,
                                     cookies=self.cookies)

    def parse(self, response):
        country = response.meta['country']
        asin = response.meta['asin']
        table_name = response.meta['table_name']
        data_list = json.loads(response.body).get('data', {})
        data_dict = data_list.get('bsrAllHistory', {})
        item = {}
        print("=================")
        for key, data in data_dict.items():
            print(key, len(data))
